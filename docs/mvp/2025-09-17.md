# 2025-09-17 MVP Timeline

## Objectives
- Finalize Pydantic models for matrix configs and generate JSON schema for IDE support.
- Implement template field extraction and draft DAX query builder aligned with matrix needs.
- Produce mock data pipeline and Plotly-based matrix renderer to demonstrate the flow end-to-end.

## Progress
- Pydantic models and JSON schema exporter established (`schemas/matrix.json` via `python -m praeparo.schema`).
- YAML loader, template field extraction, and DAX query planning implemented with mock dataset generator.
- Plotly table renderer and CLI (`praeparo`) wire the pipeline end-to-end using `tests/visuals/matrix/auto.yaml`.
- CLI confirmed to produce Plotly HTML output (`build/auto.html`) alongside generated DAX text.
- Optional PNG snapshots available via `--png-out` (`poetry add kaleido` installs the dependency; now covered by the PNG pipeline test).
- Visual fixtures reorganized under `tests/visuals/` with per-YAML syrupy snapshots (matrix today, column/scatter ready for expansion).
- DAX statements snapshotted alongside visuals for regression coverage.
- Matrix configs now accept optional `define:` DAX blocks; query builder prefixes DEFINE so templates/filters can reference derived tables or measures.
- Filters accept either `field/include` sets or raw `expression` clauses, enabling direct DAX predicates alongside the new `define:` support.
- Rows can be marked `hidden: true` to keep their field references in DAX while suppressing them from rendered visuals.
- Composition via `compose` plus top-level `parameters` lets shared base YAML drive derivatives like automatic/manual documents.
- `show_as` percent-of-total logic generates DAX expressions automatically.
- Integration tests scaffolded with real dataset/workspace IDs (skipped unless PRAEPARO_RUN_POWERBI_TESTS=1).
- Test suite runs in the Poetry environment (`poetry run pytest`) with syrupy-powered snapshots for DAX plans.
- Integration suite snapshots real Power BI responses; value fields verified non-null.
- Matrix configs now accept optional global filters; DAX builder wraps `SUMMARIZECOLUMNS` inside `CALCULATETABLE` with per-filter `column IN { ... }` clauses so filters live in the evaluation context. Latest matrix_auto run returned zero rows for the selected banks/channels (confirm dataset coverage or tweak the values next session).

- Matrix and frame visuals now default to autoHeight sizing with shared table dimensions; regenerated snapshots confirm PNG exports no longer include trailing whitespace.
- Disabled Plotly autosize and pass explicit heights into Kaleido exports so the computed dimensions are respected and the gap between stacked tables disappears.
- Refactored YAML visual loader into a registry-driven architecture that leans on Pydantic 2 validation so upcoming visuals (bar, column, etc.) only need to register their loader.
- Converted frame config models to Pydantic BaseModel for consistent validation and easier discriminated-union handling across the pipeline.
- Documented the visual model hierarchy and subclassing workflow in docs/mvp/visual_model_architecture.md so new visuals follow the union loader pattern.
- Added targeted yaml_loader tests covering frame child overrides, parameter templating, and runtime overrides.
- Elevated the visual model hierarchy with `BaseVisualConfig` and discriminated unions so the YAML loader resolves any visual type (frames now accept arbitrary child visuals without bespoke loaders).


## Blockers
- Awaiting implementation of Mock Power BI data provider and DAX measure registry decisions.
- Styling and publishing workflow requirements still undefined.

## Next Steps
- Harden template evaluation (e.g., context rendering, error messaging) and extend beyond matrix visuals.
- Add service-principal authentication flow for Power BI to replace refresh-token stopgap.
- Layer in styling/theming controls and PPTX export once visualization defaults are approved.
- Expand integration coverage with additional YAML fixtures and numeric field validations.
- Fold the visual model guide into the README once the team confirms the pattern and align future schema docs to it.
- Re-run matrix_auto integration after confirming source data values (the current filter set returns zero rows from the live dataset).
- Validate autoHeight constants against real Power BI renders (adjust header/row heights if clipping appears) and confirm expectations for horizontal frame layouts.




