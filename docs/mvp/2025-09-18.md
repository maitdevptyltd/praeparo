# 2025-09-18 MVP Timeline

## Objectives
- Share snapshot logic between pipeline and integration suites via a reusable matrix case runner.
- Allow per-visual or global data provider overrides so tests can swap between Power BI and mock datasets without rewrites.
- Keep the integration harness ready for live Power BI validation while improving local test ergonomics.

## Progress
- Introduced `tests/utils/matrix_cases.py` with `run_matrix_case`, height helpers, and a `MatrixDataProviderRegistry` that supports case-specific providers and optional PNG/HTML capture toggles.
- Refactored `tests/test_pipeline.py` to use the new runner for matrix visuals and frame children, reducing duplicate header/height assertions and centralizing data generation.
- Reworked `tests/integration/test_powerbi_matrix.py` to delegate to the shared runner and added environment-driven provider selection (`PRAEPARO_MATRIX_PROVIDER`, `PRAEPARO_MATRIX_PROVIDER_CASES`) plus PNG capture gating (`PRAEPARO_PBI_CAPTURE_PNG`).
- Confirmed local snapshots via `poetry run pytest tests/test_pipeline.py` (8 tests, 13 snapshots) with the mock provider registry.

## Blockers & Risks
- Live Power BI snapshots were not refreshed; running `poetry run pytest tests/integration/test_powerbi_matrix.py` without the expected snapshot update fails on the matrix DAX snapshot (`test_snapshot__matrix_auto`). Capture requires an approved dataset refresh and may need `--snapshot-update` once the team validates the new statements.
- Provider overrides expect case names from `case_name`; misconfigured environment strings (e.g., `PRAEPARO_MATRIX_PROVIDER_CASES="integration/matrix_auto=mock"`) will raise at import time. Documenting the canonical keys in onboarding will help avoid runtime errors.

## Next Steps
- Re-run the integration suite with `PRAEPARO_RUN_POWERBI_TESTS=1` and kaleido installed; update snapshots if the new plan ordering is correct for the live dataset.
- Extend provider overrides to accept dataset/group identifiers per case once additional workspaces are ready.
- Fold the new environment knobs into `docs/mvp/index.md` or README guidance so agents know how to opt into mock providers for integration tests.
- Consider light wrappers for asynchronous providers to avoid repeated `asyncio.run` calls when agents integrate event-loop-based fixtures.

## Test Log
- `poetry run pytest tests/test_pipeline.py`
- `poetry run pytest tests/integration/test_powerbi_matrix.py` (fails: DAX snapshot mismatch pending live data review)
